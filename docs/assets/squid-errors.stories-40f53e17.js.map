{"version":3,"file":"squid-errors.stories-40f53e17.js","sources":["../../dist/squid-errors/squid-errors.js"],"sourcesContent":["import { css, html } from 'lit';\nimport { defineSquidElement } from '../utils/defineSquidElement.js';\nimport { findParentForm } from '../utils/findParentForm.js';\nimport { findSahdowRoot } from '../utils/findShadowRoot.js';\nimport { BaseElement } from '../utils/baseElement.js';\n\nvar css_248z = css``;\n\n/**\n * @tag squid-errors\n * @summary To be used with the SquidInput it will display the error message for validation in a constant manor.\n * @prop {String} id - the id for the element to be used with labels.\n * @prop {String} _message - the message to be shown inside the error box.\n * @example\n */\nclass SquidErrors extends BaseElement {\n    static get styles() {\n        return [css_248z];\n    }\n    static get properties() {\n        return {\n            id:{type:String},\n            _message:{type:String,reflex:false}\n        };\n    }\n    constructor() {\n        super();\n        this.bindMethods(['handleChange','_onDescribesInput']);\n        /** Default validity messages intentionally newed up for each instance */\n        this.validityMessages = new Map([\n            ['customError', this._generateMessage(100, 'This field is invalid')],\n            ['badInput', this._generateMessage(4, 'This field is invalid')],\n            [\n                'patternMismatch',\n                this._generateMessage(\n                    9,\n                    'This field does not follow the proper pattern'\n                ),\n            ],\n            [\n                'rangeOverflow',\n                this._generateMessage(\n                    8,\n                    'The value does not fit in the necessary range'\n                ),\n            ],\n            [\n                'stepMismatch',\n                this._generateMessage(7, 'The value is not a valid step'),\n            ],\n            ['tooLong', this._generateMessage(6, 'The value is too long')],\n            ['tooShort', this._generateMessage(6, 'The value is too short')],\n            [\n                'typeMismatch',\n                this._generateMessage(5, 'The entered value is not the right format'),\n            ],\n            ['valueMissing', this._generateMessage(10, 'This field is required')],\n        ]);\n  \n        /** Set up inputs array */\n        this._inputs = [];\n  \n        /** Set up initial validators */\n        this.validators = this.validators || [];\n  \n    }\n    set id(value) {\n        const oldValue = value;\n        this._id = value;\n        const selector = `[aria-describedby=\"${value}\"]`;\n        const parentHost = findSahdowRoot(this);\n        if(parentHost) {\n            setTimeout(()=>this.setDescribes(parentHost));\n        } else {\n            setTimeout(() =>this.setSelector(selector));\n        }\n        this.requestUpdate('id',oldValue);\n    }\n\n    get id() {\n        return this._id;\n    }\n    get form() {\n        this._form = this._form || findParentForm(this);\n        return this._form;\n    }\n    setSelector(selector){\n        this.describes = document.querySelector(selector);\n        this._initInput(this.describes);\n        this.count = this.describes ? this.describes.value.length.toString():0;\n        this._invalidClass = {\n            checkbox: 'checkbox__input--error',\n            textarea: 'textfield__textarea--error'\n        }[this.describes.type] || 'textfield__input-error';\n        if(this.describes.tagName === 'SELECT') {\n            this._invalidClass = 'select__input--error';\n        }\n    }\n    setDescribes(parentHost){\n        this.describes = parentHost.querySelector('input');\n        if(!this.describes){\n            this.describes = parentHost.querySelector('textarea');\n                    \n        }\n        if(this.describes){\n            this._initInput(this.describes);\n            this._invalidClass = {\n                checkbox: 'checkbox__input--error',\n                textarea: 'textfield__textarea--error'\n            }[this.describes.type] || 'textfield__input-error';\n            if(this.describes.tagName === 'SELECT') {\n                this._invalidClass = 'select__input--error';\n            }\n        }\n    }\n    render(){\n        return html`<div class=\"helpers\" data-ref=\"helpers\">${this._message}</div>`;\n        \n    }\n    connectedCallback(){\n        super.connectedCallback();\n        this._addEventListeners();\n    }\n    /**\n     * \n     * @param {HTMLElement} input input assigned value\n     */\n    _addEventListeners(input) {\n        input = input || this.describes;\n        if(input) {\n            input.addEventListener('change', this.handleChange);\n            input.addEventListener('blur', this.handleChange);\n            input.addEventListener('input', this._onDescribesInput);\n            if(this.form) {\n                this.form.addEventListener('submit', this.handleChange,true);\n                this.form.addEventListener('reset', this.handleChange,true);\n            }\n        }\n    }\n    appendHelper(helper){\n        this._message = helper;\n    }\n    /**\n   * Input input event watcher used to remove errors\n   * when this.describes is altered\n   */\n    _onDescribesInput() {\n        if (this.shadowRoot.querySelector('.error')) {\n            this.appendHelper(this.validityMessages.get('valid'));\n            if (this.describes) {\n                this.describes.classList.remove(this._invalidClass);\n            } else {\n                this._inputs.forEach(input =>\n                    input.classList.remove(this._invalidClass)\n                );\n            }\n        }\n    }\n    /**\n     * check to see if we need to prevent an event.\n     * @param {Event} evt event to default\n     * @param {Boolean} isInvalid is this invalid\n     */\n    preventDefault(evt, isInvalid){\n        if (this.form === evt.target && evt.type === 'submit' && isInvalid) {\n            evt.preventDefault();\n        }\n    }\n    /**\n     * \n     * @returns {Object} validity a validity object;\n     */\n    checkValidity(){\n        let validity = {};\n        if (this.describes) {\n            validity = this.describes.validity;\n        } else if (this._inputs[0]) {\n            validity = this._inputs[0].validity;\n        }\n        if (!validity) {\n            validity = this._inputs[0].validity;\n        }\n        return validity;\n    }\n    /**\n     * \n     * @param {*} helper The helper object\n     * @returns \n     */\n    setHelper(helper) {\n        if(helper && helper.message){\n            this.appendHelper(helper.message);\n        } else {\n            this.appendHelper('');\n        }\n        \n    }\n\n    /**\n     * When the input changes display the messae\n     * @param {Event} evt the event to change\n     */\n    handleChange(evt) {\n        const describesInvalid = this.describes && this.describes.validity && this.describes.validity.valid === false;\n        const inputsInvalid = describesInvalid;\n        const isInvalid = describesInvalid || inputsInvalid;\n        this.preventDefault(evt, isInvalid);\n        let validity = this.checkValidity();\n        const validityKeys = [];\n        this.validityMessages.forEach((value, key) => validityKeys.push(key));\n        const helper = validityKeys\n            .filter(errorKey => validity[errorKey])\n            .map(errorKey => this.validityMessages.get(errorKey))\n            .reduce((current, next) => {\n                return current.priority > next.priority ? current : next;\n            }, {});\n        \n        \n        this.setHelper(helper);\n\n        if (this.describes) {\n            if (validity.valid === false) {\n                this._inputInvalid(this.describes);\n            } else {\n                this._inputValid(this.describes);\n            }\n        } else if (this._inputs.length) {\n            if (validity.valid === false) {\n                this._inputs.forEach(this._inputInvalid);\n            } else {\n                this._inputs.forEach(this._inputValid);\n            }\n        }\n    }\n    _inputInvalid(input) {\n        input.classList.add(this._invalidClass);\n        input.setAttribute('aria-invalid',true);\n    }\n    _inputValid(input) {\n        input.classList.remove(this._invalidClass);\n        input.setAttribute('aria-invalid',false);\n    }\n    /**\n     * \n     * @param {HTMLElement} element input element\n     */\n    _initInput(element) {\n        if(element && element.dataset.helperText) {\n            this._message = element.dataset.helperText;\n        } else {\n            this._message = this.innerHTML;\n        }\n        this._addEventListeners(element);\n    }\n    /**\n     * Set the message\n     * @param {Number} priority \n     * @param {String} message \n     * @param {String} type \n     */\n    _generateMessage(priority, message, type = 'error') {\n        return {priority, message, type};\n    }\n    /**\n     * bind this to the method\n     * @param {String} methodName \n     * @returns void\n     */\n    bindMethod(methodName) {\n        this[methodName] = this[methodName].bind(this);\n    }\n    /**\n     * binds the array of methods with this.\n     * @param {Array<String>} methods\n     * @returns void \n     */\n    bindMethods(methods =[]) {\n        methods.forEach(method => this.bindMethod(method));\n    }\n    /**\n     * Set the error message with this one.\n     * @param {String} message error message\n     */\n    setCustomError(message){\n        const customMessage = this.validityMessages.get('customError');\n        customMessage.message = message;\n    }\n}\nclass SquidHelpers extends SquidErrors{}\ndefineSquidElement('squid-errors',SquidErrors);\ndefineSquidElement('squid-helpers',SquidHelpers);\n\nexport { SquidErrors };\n"],"names":["css_248z","css","SquidErrors","BaseElement","value","oldValue","selector","parentHost","findSahdowRoot","findParentForm","html","input","helper","evt","isInvalid","validity","describesInvalid","validityKeys","key","errorKey","current","next","element","priority","message","type","methodName","methods","method","customMessage","SquidHelpers","defineSquidElement"],"mappings":"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"}