{"version":3,"file":"squid-credit-card.stories-8bc2e35e.js","sources":["../../dist/squid-credit-card/squid-credit-card.js"],"sourcesContent":["import { SquidSsn } from '../squid-ssn/squid-ssn.js';\nimport { defineSquidElement } from '../utils/defineSquidElement.js';\nimport { css } from 'lit';\n\nvar css_248z = css``;\n\n/**\r\n * @tag squid-credit-card\r\n * @summary `SquidCreditCard` is an implementation of [`SquidInput`](../squid-input) that serves as a credit-card number mask for privacy reasons.\r\n * @prop {String} value - value of the input.\r\n * @event squid-change - The input value has changed.\r\n * @example <form name=\"cc-number\" autocomplete=\"cc-number\"><squid-credit-card>Credit Card</squid-credit-card></form>\r\n */\r\nclass SquidCreditCard extends SquidSsn {\r\n    static get styles() {\r\n        return [...super.styles,css_248z];\r\n    }\r\n    static get properties() {\r\n        return {...super.properties};\r\n    }\r\n    constructor() {\r\n        super();\r\n        this.name = 'ccnumber';\r\n        this.autocomplete = 'cc-number';\r\n    }\r\n    \r\n    firstUpdated(){\r\n        super.firstUpdated();\r\n        this._placeholder = '****************';\r\n        this.minlength = 16;\r\n        this.maxlength = 16;\r\n        console.log(this.value);\r\n    }\r\n    /**\r\n     * Mask the value of the SSN\r\n     * @param {String} value value to add a mask to\r\n     */\r\n    _addMask(value=''){\r\n        const placeholderCharacter = '-';\r\n        const unmaskedValue = this._unmask(value);\r\n        const firstThree = unmaskedValue.slice(0, 16).padEnd(16, placeholderCharacter);\r\n        let maskedValue = '';\r\n        maskedValue += firstThree;\r\n        this.maskedValue = firstThree;\r\n        return maskedValue;\r\n    }\r\n    /**\r\n     * Unmask the input value\r\n     * @param {String} value the Masked value\r\n     */\r\n    _unmask(value=''){\r\n        return value.replace(/\\D/g, '').slice(0, 16);\r\n    }\r\n    /**\r\n     * Mask the value to not be seen\r\n     * @param {String} value value to be masked\r\n     * @param {Event} evt keyboard event\r\n     */\r\n    async _mask(value='', evt={}) {\r\n        const unmaskedValue = this._unmask(value);\r\n        const maskedValue = this._addMask(unmaskedValue);\r\n        const isDelete = evt.inputType === 'deleteContentBackward';\r\n        this.unmaskedValue = unmaskedValue;\r\n        this.maskedValue = maskedValue;\r\n    \r\n        const obfuscateValue = await this._obfuscate(maskedValue);\r\n        const start = isDelete ?  this._cachedSelection : unmaskedValue.length;\r\n        this._manageCursor(obfuscateValue, start, evt);\r\n        this._isDelete = undefined;\r\n    }\r\n    /**\r\n     * Manage the location of the cursor\r\n     * @param {String} maskedValue the masked value\r\n     * @param {number} selectionStart the current cursor location\r\n     * @param {Event} event keyboard Event\r\n     */\r\n    _manageCursor(maskedValue, selectionStart, evt={}) {\r\n    \r\n        if (evt.inputType === 'deleteContentBackward') {\r\n            selectionStart = this._cachedSelection - 1;\r\n        }\r\n    \r\n        this.__getInput().setSelectionRange(selectionStart, selectionStart);\r\n    }\r\n    /**\r\n     * Obfuscate the input value\r\n     * @param {String} value value to obfucate\r\n     */\r\n    _obfuscate(value=''){\r\n        return new Promise(resolve => {\r\n            const input  = this.__getInput();\r\n            let obfuscatedValue = value.slice(0, 12).replace(/[0-9]/g, 'â€¢') + value.slice(12, 16);\r\n            this._obfuscatedValue = obfuscatedValue;\r\n            this._value = this.unmaskedValue.slice(0, 16);\r\n            if (this.maskState === 'visible') {\r\n                input.value = value;\r\n            } else {\r\n                input.value = this._obfuscatedValue;\r\n            }\r\n            resolve(this.maskedValue);\r\n        });\r\n    }\r\n    /**\r\n     * Overwrite the checkValidity to handel error messages\r\n     */\r\n    checkValidity() {\r\n        console.log(this.internals.form);\r\n        if (!this._value ||this._value.length < 16 || !this.luhnCheck(this._value)){\r\n            this.setCustomValidity('Please enter in a valid credit card number');\r\n            return false;\r\n        } else {\r\n            this.setCustomValidity('');\r\n        }\r\n        return super.checkValidity();\r\n    }\r\n    /**\r\n     * This is a luhn algorithm  or modulus 10 to check if it is a valid cc number\r\n     * @param {Number} number credit card number to check the luhn alg\r\n     * @returns Boolean\r\n     */\r\n    luhnCheck(number){\r\n        let nCheck = 0;\r\n        number = number.replace(/\\D/g,'');\r\n        number.split('').forEach((item, n) => {\r\n            let nDigit = parseInt(item, 10);\r\n            if (!(n % 2) && (nDigit *= 2) > 9) nDigit -= 9;\r\n            nCheck += nDigit;\r\n        });\r\n        return (nCheck % 10) === 0;\r\n    }\r\n    \r\n}\r\ndefineSquidElement('squid-credit-card',SquidCreditCard);\n\nexport { SquidCreditCard };\n"],"names":["css_248z","css","SquidCreditCard","SquidSsn","value","placeholderCharacter","firstThree","maskedValue","evt","unmaskedValue","isDelete","obfuscateValue","start","selectionStart","resolve","input","obfuscatedValue","number","nCheck","item","n","nDigit","defineSquidElement"],"mappings":"iUAIA,IAAIA,EAAWC,IASf,MAAMC,UAAwBC,CAAS,CACnC,WAAW,QAAS,CAChB,MAAO,CAAC,GAAG,MAAM,OAAOH,CAAQ,CACnC,CACD,WAAW,YAAa,CACpB,MAAO,CAAC,GAAG,MAAM,UAAU,CAC9B,CACD,aAAc,CACV,QACA,KAAK,KAAO,WACZ,KAAK,aAAe,WACvB,CAED,cAAc,CACV,MAAM,aAAY,EAClB,KAAK,aAAe,mBACpB,KAAK,UAAY,GACjB,KAAK,UAAY,GACjB,QAAQ,IAAI,KAAK,KAAK,CACzB,CAKD,SAASI,EAAM,GAAG,CACd,MAAMC,EAAuB,IAEvBC,EADgB,KAAK,QAAQF,CAAK,EACP,MAAM,EAAG,EAAE,EAAE,OAAO,GAAIC,CAAoB,EAC7E,IAAIE,EAAc,GAClB,OAAAA,GAAeD,EACf,KAAK,YAAcA,EACZC,CACV,CAKD,QAAQH,EAAM,GAAG,CACb,OAAOA,EAAM,QAAQ,MAAO,EAAE,EAAE,MAAM,EAAG,EAAE,CAC9C,CAMD,MAAM,MAAMA,EAAM,GAAII,EAAI,CAAA,EAAI,CAC1B,MAAMC,EAAgB,KAAK,QAAQL,CAAK,EAClCG,EAAc,KAAK,SAASE,CAAa,EACzCC,EAAWF,EAAI,YAAc,wBACnC,KAAK,cAAgBC,EACrB,KAAK,YAAcF,EAEnB,MAAMI,EAAiB,MAAM,KAAK,WAAWJ,CAAW,EAClDK,EAAQF,EAAY,KAAK,iBAAmBD,EAAc,OAChE,KAAK,cAAcE,EAAgBC,EAAOJ,CAAG,EAC7C,KAAK,UAAY,MACpB,CAOD,cAAcD,EAAaM,EAAgBL,EAAI,CAAA,EAAI,CAE3CA,EAAI,YAAc,0BAClBK,EAAiB,KAAK,iBAAmB,GAG7C,KAAK,WAAY,EAAC,kBAAkBA,EAAgBA,CAAc,CACrE,CAKD,WAAWT,EAAM,GAAG,CAChB,OAAO,IAAI,QAAQU,GAAW,CAC1B,MAAMC,EAAS,KAAK,aACpB,IAAIC,EAAkBZ,EAAM,MAAM,EAAG,EAAE,EAAE,QAAQ,SAAU,GAAG,EAAIA,EAAM,MAAM,GAAI,EAAE,EACpF,KAAK,iBAAmBY,EACxB,KAAK,OAAS,KAAK,cAAc,MAAM,EAAG,EAAE,EACxC,KAAK,YAAc,UACnBD,EAAM,MAAQX,EAEdW,EAAM,MAAQ,KAAK,iBAEvBD,EAAQ,KAAK,WAAW,CACpC,CAAS,CACJ,CAID,eAAgB,CAEZ,OADA,QAAQ,IAAI,KAAK,UAAU,IAAI,EAC3B,CAAC,KAAK,QAAS,KAAK,OAAO,OAAS,IAAM,CAAC,KAAK,UAAU,KAAK,MAAM,GACrE,KAAK,kBAAkB,4CAA4C,EAC5D,KAEP,KAAK,kBAAkB,EAAE,EAEtB,MAAM,gBAChB,CAMD,UAAUG,EAAO,CACb,IAAIC,EAAS,EACb,OAAAD,EAASA,EAAO,QAAQ,MAAM,EAAE,EAChCA,EAAO,MAAM,EAAE,EAAE,QAAQ,CAACE,EAAMC,IAAM,CAClC,IAAIC,EAAS,SAASF,EAAM,EAAE,EAC1B,EAAEC,EAAI,KAAOC,GAAU,GAAK,IAAGA,GAAU,GAC7CH,GAAUG,CACtB,CAAS,EACOH,EAAS,KAAQ,CAC5B,CAEL,CACAI,EAAmB,oBAAoBpB,CAAe;;;;;;;;;;"}