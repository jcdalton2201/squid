{"version":3,"file":"squid-combobox.stories-580eed56.js","sources":["../../dist/squid-combobox/squid-combobox.js"],"sourcesContent":["import { css, html } from 'lit';\nimport { SquidInputBase } from '../squid-input-base/squid-input-base.js';\nimport { defineSquidElement } from '../utils/defineSquidElement.js';\n\nvar css_248z = css`squid-helpers{color:var(--color-alert-error,#de2131)}label{color:var(--dark-gray,#4d4d4d);font-size:.75rem;letter-spacing:.5px;margin-bottom:var(--padding-small,4px);opacity:.9}.combobox-wrapper{font-size:1rem;position:relative}.combobox-wrapper input{background-image:none;border:2px solid var(--gray-default,#999);border-radius:var(--radius-default,4px);box-shadow:none;font-size:1rem;height:var(--height-default,1rem);line-height:1.5;margin:0;padding:var(--padding-default,8px);width:auto}.combobox-wrapper input:disabled{cursor:not-allowed}.combobox-wrapper input:read-only{cursor:not-allowed}.combobox-wrapper input.textfield__input--error{border:2px solid var(--color-alert-error,#de2131)}.combobox-wrapper .grid{background:#fff;border:1px solid #1a1a1a;display:none;list-style:none;margin:9px 0 0;min-width:230px;padding:0;position:absolute;top:1.7em;z-index:1}.combobox-wrapper .grid[open]{display:block}.combobox-wrapper .grid .result-row{cursor:default;margin:0;padding:2px}.combobox-wrapper .grid .result-row.active-decendant,.combobox-wrapper .grid .result-row:hover{background-color:#d1defa}.combobox-wrapper .grid .result-row:focus{background-color:#d1defa;outline:1px auto webkit-focus-ring-color}`;\n\n/**\r\n * @tag squid-combobox\r\n * @summary A combobox is a combination of input element and a select element much like a [datalist](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist), but with some subtle differences. The W3C defines a combobox as:\r\n\r\n> A combobox is a widget made up of the combination of two distinct elements: 1) a single-line textbox, and 2) an associated pop-up element for helping users set the value of the textbox. The popup may be a listbox, grid, tree, or dialog. Many implementations also include a third optional element -- a graphical button adjacent to the textbox, indicating the availability of the popup. Activating the button displays the popup if suggestions are available.\r\n_[-source](https://www.w3.org/TR/wai-aria-practices/#combobox)_\r\n * @prop {Boolean} disabled - A proxy for the input disabled attribute. Reflected as a property. \r\n * @prop {Boolean} required - A proxy for the input disabled attribute. Reflected as a property. \r\n * @prop {Boolean} autofocus -  A proxy for the input autofocus attribute. Reflected as a property. \r\n * @prop {String} tooltip -  Sets a tooltip on the combobox label using [`SquidTooltip`](../squid-tooltip). Reflected as a property. \r\n * @prop {String} placeholder -  A proxy for the input placeholder attribute. Reflected as a property. \r\n * @prop {String} size -  Can set the size on the input. Reflected as a property. \r\n * @prop {String} value -  Sets the input's value and emits an `squid-change` event when updated. Reflected as a property. \r\n * @prop {String} datalabel -  Set the string to tell you what property you wish to show in your object array\r\n * @prop {String} datavalue -  Set the string to tell you what property you wish to be your key in your object array\r\n * @prop {Array} data -  This is the data set you wish to show in the popdown.  It can be an Array of Strings\r\nor an Array of objects with datalabel and datavalue attributes set\r\n * @event squid-change - A [`CustomEvent`](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent) emitted each time a new value is comitted. The event's `detail` property will contain the newly comitted value. \r\n * @example <squid-combobox name=\"world\" placeholder=\"Harry Potter characters\">\r\n  <label slot=\"label\">Favorite Harry Potter Character</label>\r\n  <option value=\"ME\">Harry Potter</option>\r\n  <option value=\"Ron Weasley\">Ron Weasley</option>\r\n  <option value=\"Hermione Granger\">Hermione Granger</option>\r\n  <option value=\"Albus Dumbledore\">Albus Dumbledore</option>\r\n  <option value=\"Severus Snape\">Severus Snape</option>\r\n  <option value=\"Sirius Black\">Sirius Black</option>\r\n  <option value=\"Neville 'freaking' Longbottom\">Neville Longbottom</option>\r\n  <option value=\"Voldemort\">He Who Must Not Be Named</option>\r\n</squid-combobox>\r\n */\r\nclass SquidCombobox extends SquidInputBase {\r\n    static get styles() {\r\n        return [css_248z];\r\n    }\r\n    static get properties() {\r\n        return {\r\n            value:{\r\n                type:String,\r\n                attribute:true,\r\n                reflect:true},\r\n            disabled:{type:Boolean},\r\n            required:{type:Boolean},\r\n            readonly:{type:Boolean},\r\n            autofocus:{type:Boolean},\r\n            datalabel:{type:String,attribute:true,},\r\n            datavalue:{type:String,attribute:true}\r\n        };\r\n    }\r\n    constructor() {\r\n        super();\r\n        this.bindMethods(['_openOptions','_closeOptions','_keyDown', '_selectNext','_selectPrevious','_keyInput','_selectValue',]);\r\n        this._data = [];\r\n        this._displayData = [];\r\n        this.activeElemen = null;\r\n        this.addEventListener('blur', this._closeOptions);\r\n    }\r\n    set value(value) {\r\n        if(this.renderRoot.querySelector('input')){\r\n            const oldValue = this.renderRoot.querySelector('input').value;\r\n            if(value !== oldValue) {\r\n                if(this._objectData){\r\n                    const objValue = [...this._objectData.values()].indexOf(value);\r\n                    this.renderRoot.querySelector('input').value = [...this._objectData.keys()][objValue];\r\n                } else {\r\n                    this.renderRoot.querySelector('input').value = value; \r\n                }\r\n            }\r\n            this.dispatchEvent(new CustomEvent('squid-input-change'));\r\n        }\r\n    }\r\n    get value(){\r\n        if(this.renderRoot.querySelector('input')){\r\n            if(this._objectData){\r\n                return this._objectData.get(this.renderRoot.querySelector('input').value);\r\n            }\r\n            return this.renderRoot.querySelector('input').value;\r\n        }\r\n        return '';\r\n    }\r\n    \r\n    set data(value){\r\n        \r\n        let oldValue = this._data;\r\n        this._objectData = null;\r\n        if(value.find(item => typeof item === 'object')) {\r\n            if(!this.datalabel || !this.datavalue){\r\n                console.error(`We must have a ${this.datalabel?'':' datalabel '} ${this.datavalue?'':' datavalue '}`);\r\n            }\r\n            this._objectData = new Map();\r\n            value.forEach(item => this._objectData.set(item[this.datalabel],item[this.datavalue]));\r\n            this._data = [...this._objectData.keys()];\r\n        } else {\r\n            this._data = value;\r\n        }\r\n        this._displayData = this._data;\r\n        this.requestUpdate('data',oldValue);\r\n    }\r\n    firstUpdated(){\r\n        this.buildRefs();\r\n        \r\n    }\r\n    render(){\r\n        return html`\r\n<div id=\"container\" data-ref=\"wrapper\">\r\n    <label for=\"\" id='${this.id}-label' class='combobox-label'><slot name='label'></slot></label>\r\n    <div class='combobox-wrapper'>\r\n        <div id='${this.id}-combobox'>\r\n            <input type='text' role=\"combobox\"\r\n            aria-labelledby='${this.id}-label'\r\n            aria-haspopup=\"grid\"\r\n            aria-expanded=\"false\"\r\n            aria-autocomplete=\"list\"\r\n            aria-controls=\"ex1-grid\"\r\n            id=${this.id}-input\r\n            data-ref=\"input\"\r\n            ?disabled=${this.disabled}\r\n            ?required=${this.required}\r\n            ?readonly=${this.readonly}\r\n            ?autofocus=${this.autofocus}\r\n\r\n            @input=${this._keyInput}\r\n            @keydown=${this._keyDown}\r\n            aria-describedby=\"helpers-${this._uid}\"\r\n            >\r\n            <squid-helpers id=\"helpers-${this._uid}\" data-ref=\"helpers\"></squid-helpers>\r\n        </div>\r\n        <div aria-labelledby=\"${this.id}-label\"\r\n            role=\"grid\"\r\n            data-ref=\"optionsList\"\r\n            id=\"${this.id}-grid\"\r\n            class=\"grid hidden\">\r\n            ${this._displayData.map((option, index) => html`\r\n            <div tabindex=\"-1\" class=\"result-row\" role=\"row\" id=\"result-row-${index}\" @click=${this._selectValue}>\r\n                ${option}\r\n            </div>`)}\r\n        </div>\r\n    </div>\r\n</div> \r\n        `;\r\n    }\r\n    /**\r\n       * Open the option grid\r\n       */\r\n    _openOptions(){\r\n        if(!this.disabled){\r\n            const { optionsList, input } = this.refs;\r\n            optionsList.setAttribute('open', 'open');\r\n            input.setAttribute('aria-expanded', 'true');\r\n        }\r\n    }\r\n    /**\r\n       * Closes the option grid\r\n       */\r\n    _closeOptions(){\r\n        if(!this.disabled){\r\n            const { optionsList, input } = this.refs;\r\n            optionsList.removeAttribute('open');\r\n            input.setAttribute('aria-expanded', 'false');\r\n        }\r\n    }\r\n    /**\r\n     * Capture the key down event\r\n     * @param {Event} evt keydown event\r\n     */\r\n    _keyDown(evt){\r\n        const { optionsList } = this.refs;\r\n        if(optionsList.hasAttribute('open')){\r\n            if(evt.key === 'ArrowDown' || evt.key === 'ArrowRight'){\r\n                this._selectNext();\r\n            }\r\n            if(evt.key === 'ArrowUp'|| evt.key === 'ArrowLeft'){\r\n                this._selectPrevious();\r\n            }\r\n            if(evt.key === 'Enter'){\r\n                const { input } = this.refs;\r\n                input.value = this._displayData[this.activeElement];\r\n                this._closeOptions();\r\n            }\r\n        }\r\n        // } else {\r\n        //     this._openOptions();\r\n        // }\r\n        if(evt.key === 'Escape'){\r\n            const { input } = this.refs;\r\n            input.value = '';\r\n            this._closeOptions();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    _selectPrevious() {\r\n        const elements = this.shadowRoot.querySelector('.active-decendant');\r\n        if(elements){\r\n            elements.classList.remove('active-decendant');\r\n        }\r\n        if(this.activeElement === undefined){\r\n            this.activeElement = this._displayData.length - 1;\r\n        } else {\r\n            if(this.activeElement === 0) {\r\n                this.activeElement = this._displayData.length - 1;\r\n            } else {\r\n                this.activeElement--;\r\n            }\r\n        }\r\n        this.shadowRoot.querySelectorAll('.result-row').item(this.activeElement).classList.add('active-decendant');\r\n    }\r\n    /**\r\n     * \r\n     * \r\n     * @return {Element} new active element\r\n     */\r\n    _selectNext() {\r\n        const elements = this.shadowRoot.querySelector('.active-decendant');\r\n        if(elements){\r\n            elements.classList.remove('active-decendant');\r\n        }\r\n        if(this.activeElement === undefined){\r\n            this.activeElement = 0;\r\n        } else {\r\n            if(this.activeElement === this._displayData.length - 1) {\r\n                this.activeElement = 0;\r\n            } else {\r\n                this.activeElement++;\r\n            }\r\n        }\r\n        this.shadowRoot.querySelectorAll('.result-row').item(this.activeElement).classList.add('active-decendant');\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Event} evt Input value of the key\r\n     */\r\n    _keyInput(evt){\r\n        const { optionsList, input } = this.refs;\r\n        const oldValue = this._displayData;\r\n        if(!optionsList.hasAttribute('open')){\r\n            if(input.value && evt.key !== 'ArrowDown' && evt.key !== 'ArrowUp'){\r\n                this._openOptions();\r\n            }\r\n        }\r\n        this._displayData = this._data.filter(label => {\r\n            return label.toLowerCase().includes(input.value.toLowerCase());\r\n        });\r\n        if(this._displayData.length === 0){\r\n            this._closeOptions();\r\n        }\r\n        this.activeElement = undefined;\r\n        const elements = this.shadowRoot.querySelector('.active-decendant');\r\n        if(elements){\r\n            elements.classList.remove('active-decendant');\r\n        }\r\n        this.requestUpdate('_displayData',oldValue);\r\n    }\r\n\r\n    /**\r\n     * the click event for a selected value\r\n     * @param {MouseEvent} evt click event\r\n     */\r\n    _selectValue(evt){\r\n        const item = parseInt(evt.currentTarget.id.replace('result-row-',''));\r\n        const { input } = this.refs;\r\n        input.value = this._displayData[item];\r\n        this.activeElement = undefined;\r\n        this._closeOptions();\r\n    }\r\n\r\n}\r\ndefineSquidElement('squid-combobox',SquidCombobox);\n\nexport { SquidCombobox };\n"],"names":["css_248z","css","SquidCombobox","SquidInputBase","value","oldValue","objValue","item","html","option","index","optionsList","input","evt","elements","label","defineSquidElement"],"mappings":"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"}